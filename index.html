<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>n8n Web Scraping Infographic</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-dark': '#1A535C',
                        'brand-teal': '#4ECDC4',
                        'brand-light': '#F7FFF7',
                        'brand-coral': '#FF6B6B',
                        'brand-yellow': '#FFE66D',
                    },
                    fontFamily: {
                        sans: ['Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Chart Container Styling - Mandatory Requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Constraint for large screens */
            margin-left: auto;
            margin-right: auto;
            height: 300px; /* Base height */
            max-height: 400px;
        }

        /* Responsive height adjustments */
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        
        /* Card Hover Effects */
        .hover-lift {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
    <!-- 
        HTML Comment: Palette Selection
        Palette: "Energetic & Playful"
        Hex Codes: #1A535C (Dark Blue), #4ECDC4 (Teal), #F7FFF7 (Off White), #FF6B6B (Coral), #FFE66D (Yellow)
        Justification: High contrast, modern tech feel suitable for automation and AI topics.
    -->
    <!-- 
        HTML Comment: Narrative Plan
        1. Hero Section: Hook user with the problem (messy web data) and solution (n8n + AI).
        2. The Pipeline (Flowchart): Visualizing the 5 steps defined in the guide.
        3. Reliability Analysis (Bar Chart): Comparing traditional scraping vs ScrapeNinja.
        4. Efficiency/Token Savings (Donut Chart): Showing the value of the HTML Cleaning step.
        5. Detailed Breakdown: Explaining Trigger, Fetch, Clean, Extract, Parse.
        6. Conclusion: Wrap up with benefits.
    -->
</head>
<body class="bg-brand-light text-gray-800 font-sans leading-relaxed">

    <!-- HERO SECTION -->
    <header class="bg-brand-dark text-white py-12 px-4 shadow-lg">
        <div class="max-w-6xl mx-auto text-center">
            <h1 class="text-4xl md:text-6xl font-bold mb-4 tracking-tight text-brand-yellow">From HTML Chaos to JSON Order</h1>
            <p class="text-xl md:text-2xl text-brand-teal font-light max-w-3xl mx-auto">
                A visual guide to building a production-ready web scraping pipeline using n8n, ScrapeNinja, and Generative AI.
            </p>
            <div class="mt-8 flex justify-center space-x-4">
                <div class="px-4 py-2 bg-brand-coral rounded-full text-sm font-bold shadow-md">Robust Proxies</div>
                <div class="px-4 py-2 bg-brand-teal text-brand-dark rounded-full text-sm font-bold shadow-md">AI Extraction</div>
                <div class="px-4 py-2 bg-brand-yellow text-brand-dark rounded-full text-sm font-bold shadow-md">Token Savings</div>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT GRID -->
    <main class="max-w-7xl mx-auto px-4 py-12 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-12 gap-8">

        <!-- INTRO & CONTEXT (Full Width) -->
        <section class="col-span-1 md:col-span-2 lg:col-span-12 mb-8">
            <div class="bg-white p-8 rounded-xl shadow-md border-l-8 border-brand-coral">
                <h2 class="text-3xl font-bold text-brand-dark mb-4">The Scraping Challenge</h2>
                <p class="text-lg text-gray-600">
                    Web scraping is traditionally fragile. Layouts change, IPs get blocked, and extracting specific data points from messy HTML requires complex selectors. 
                    This infographic visualizes a <strong>5-step n8n workflow</strong> that solves these problems by combining <strong>ScrapeNinja's</strong> robust rendering with <strong>AI's</strong> intelligent extraction.
                </p>
            </div>
        </section>

        <!-- VISUALIZATION 1: THE WORKFLOW FLOWCHART (Full Width) -->
        <!-- Goal: Organize (Process Flow) -->
        <!-- Method: Structured HTML/Tailwind (No SVG, No Mermaid) -->
        <section class="col-span-1 md:col-span-2 lg:col-span-12">
            <h3 class="text-2xl font-bold text-brand-dark mb-6 text-center">The Automated Pipeline</h3>
            <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0 md:space-x-4 p-6 bg-gray-100 rounded-xl overflow-x-auto">
                
                <!-- Step 1 -->
                <div class="flex flex-col items-center min-w-[150px]">
                    <div class="w-16 h-16 bg-brand-dark text-white rounded-full flex items-center justify-center text-2xl font-bold shadow-lg mb-2">1</div>
                    <div class="bg-white p-4 rounded-lg shadow-md text-center w-full border-t-4 border-brand-dark hover-lift">
                        <h4 class="font-bold text-gray-800">Trigger</h4>
                        <p class="text-xs text-gray-500">Manual, Webhook, or Schedule</p>
                    </div>
                </div>

                <!-- Arrow -->
                <div class="text-3xl text-gray-400 font-bold transform rotate-90 md:rotate-0">&#10140;</div>

                <!-- Step 2 -->
                <div class="flex flex-col items-center min-w-[150px]">
                    <div class="w-16 h-16 bg-brand-coral text-white rounded-full flex items-center justify-center text-2xl font-bold shadow-lg mb-2">2</div>
                    <div class="bg-white p-4 rounded-lg shadow-md text-center w-full border-t-4 border-brand-coral hover-lift">
                        <h4 class="font-bold text-gray-800">ScrapeNinja</h4>
                        <p class="text-xs text-gray-500">Robust Fetch & Proxy Rotation</p>
                    </div>
                </div>

                <!-- Arrow -->
                <div class="text-3xl text-gray-400 font-bold transform rotate-90 md:rotate-0">&#10140;</div>

                <!-- Step 3 -->
                <div class="flex flex-col items-center min-w-[150px]">
                    <div class="w-16 h-16 bg-brand-yellow text-brand-dark rounded-full flex items-center justify-center text-2xl font-bold shadow-lg mb-2">3</div>
                    <div class="bg-white p-4 rounded-lg shadow-md text-center w-full border-t-4 border-brand-yellow hover-lift">
                        <h4 class="font-bold text-gray-800">HTML Clean</h4>
                        <p class="text-xs text-gray-500">Strip Scripts & Styles</p>
                    </div>
                </div>

                <!-- Arrow -->
                <div class="text-3xl text-gray-400 font-bold transform rotate-90 md:rotate-0">&#10140;</div>

                <!-- Step 4 -->
                <div class="flex flex-col items-center min-w-[150px]">
                    <div class="w-16 h-16 bg-brand-teal text-white rounded-full flex items-center justify-center text-2xl font-bold shadow-lg mb-2">4</div>
                    <div class="bg-white p-4 rounded-lg shadow-md text-center w-full border-t-4 border-brand-teal hover-lift">
                        <h4 class="font-bold text-gray-800">AI Extract</h4>
                        <p class="text-xs text-gray-500">LLM Chain Analysis</p>
                    </div>
                </div>

                <!-- Arrow -->
                <div class="text-3xl text-gray-400 font-bold transform rotate-90 md:rotate-0">&#10140;</div>

                <!-- Step 5 -->
                <div class="flex flex-col items-center min-w-[150px]">
                    <div class="w-16 h-16 bg-green-600 text-white rounded-full flex items-center justify-center text-2xl font-bold shadow-lg mb-2">5</div>
                    <div class="bg-white p-4 rounded-lg shadow-md text-center w-full border-t-4 border-green-600 hover-lift">
                        <h4 class="font-bold text-gray-800">JSON Parse</h4>
                        <p class="text-xs text-gray-500">Structured Data Output</p>
                    </div>
                </div>

            </div>
        </section>

        <!-- VISUALIZATION 2: RELIABILITY (Chart.js Bar) -->
        <!-- Goal: Compare (Success Rate) -->
        <!-- Justification: Bar chart effectively contrasts the high failure rate of basic HTTP requests vs ScrapeNinja. -->
        <section class="col-span-1 md:col-span-1 lg:col-span-6 bg-white p-6 rounded-xl shadow-md">
            <h3 class="text-xl font-bold text-brand-dark mb-2">Why Use ScrapeNinja?</h3>
            <p class="text-sm text-gray-600 mb-6">
                Standard HTTP requests often fail due to anti-bot measures or JavaScript rendering requirements. ScrapeNinja handles proxies and rendering, significantly boosting success rates.
            </p>
            <div class="chart-container">
                <canvas id="reliabilityChart"></canvas>
            </div>
            <!-- HTML Comment: Visualization 2 Data Point -> Goal: Compare -> Chart: Bar Chart -> Library: Chart.js (No SVG) -->
        </section>

        <!-- VISUALIZATION 3: TOKEN OPTIMIZATION (Chart.js Donut) -->
        <!-- Goal: Inform/Compare (Composition) -->
        <!-- Justification: Donut chart visualizes the proportion of "waste" (scripts/styles) removed by the cleaning step, highlighting cost efficiency for AI. -->
        <section class="col-span-1 md:col-span-1 lg:col-span-6 bg-white p-6 rounded-xl shadow-md">
            <h3 class="text-xl font-bold text-brand-dark mb-2">Optimization: Saving AI Tokens</h3>
            <p class="text-sm text-gray-600 mb-6">
                Raw HTML is heavy. Step 3 (HTML Cleaning) uses regex to strip <code>&lt;script&gt;</code>, <code>&lt;style&gt;</code>, and <code>&lt;svg&gt;</code> tags, sending only the relevant content to the AI to reduce costs.
            </p>
            <div class="chart-container">
                <canvas id="tokenChart"></canvas>
            </div>
            <!-- HTML Comment: Visualization 3 Data Point -> Goal: Compare/Composition -> Chart: Donut Chart -> Library: Chart.js (No SVG) -->
        </section>

        <!-- STEP-BY-STEP DETAILS (Cards) -->
        <section class="col-span-1 md:col-span-2 lg:col-span-12">
            <h3 class="text-2xl font-bold text-brand-dark mb-6 mt-4">Detailed Process Breakdown</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- Step 2 Detail -->
                <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-brand-coral">
                    <div class="text-brand-coral font-bold text-lg mb-2">Step 2: Robust Fetching</div>
                    <p class="text-sm text-gray-700 mb-4">
                        We avoid the standard n8n HTTP node for direct access. Instead, we POST to <strong>ScrapeNinja</strong>.
                    </p>
                    <ul class="text-sm text-gray-600 list-disc list-inside">
                        <li>Endpoint: <code>/scrape</code></li>
                        <li>Method: POST</li>
                        <li>Key Feature: Rotating Proxies & Headers</li>
                    </ul>
                </div>

                <!-- Step 3 Detail -->
                <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-brand-yellow">
                    <div class="text-brand-yellow-600 font-bold text-lg mb-2">Step 3: The Code Node</div>
                    <p class="text-sm text-gray-700 mb-4">
                        A critical JavaScript step to sanitize the input before the AI stage.
                    </p>
                    <div class="bg-gray-800 text-green-400 p-3 rounded text-xs font-mono overflow-x-auto">
                        html.replace(/&lt;script.../gm, "")<br>
                        .replace(/&lt;style.../gm, "")<br>
                        .trim()
                    </div>
                </div>

                <!-- Step 4 Detail -->
                <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-brand-teal">
                    <div class="text-brand-teal font-bold text-lg mb-2">Step 4: AI Extraction</div>
                    <p class="text-sm text-gray-700 mb-4">
                        Using an <strong>LLM Chain</strong> (OpenAI gpt-4o-mini) with a strict system prompt.
                    </p>
                    <div class="bg-gray-100 p-3 rounded border border-gray-200 text-xs italic text-gray-600">
                        "You are a precise data extraction engine. You only output valid JSON."
                    </div>
                </div>

            </div>
        </section>

        <!-- VISUALIZATION 4: DATA TRANSFORMATION (Chart.js Stacked Bar) -->
        <!-- Goal: Compare (Volume/Complexity) -->
        <!-- Justification: Visualizing the reduction in complexity from Raw HTML to Clean HTML to Final JSON. -->
        <section class="col-span-1 md:col-span-2 lg:col-span-12 bg-white p-6 rounded-xl shadow-md mt-4">
            <h3 class="text-xl font-bold text-brand-dark mb-2">Data Transformation Journey</h3>
            <p class="text-sm text-gray-600 mb-6">
                Visualizing the volume of characters processed at each stage. The process aggressively filters noise to deliver high-value structured data.
            </p>
            <div class="chart-container">
                <canvas id="transformationChart"></canvas>
            </div>
             <!-- HTML Comment: Visualization 4 Data Point -> Goal: Change/Process -> Chart: Bar Chart -> Library: Chart.js (No SVG) -->
        </section>

        <!-- FOOTER -->
        <footer class="col-span-1 md:col-span-2 lg:col-span-12 mt-8 text-center border-t border-gray-200 pt-8">
            <p class="text-gray-500 mb-2">Based on the n8n Tutorial: <em>Scrape Any Web Page into Structured JSON with ScrapeNinja & AI</em></p>
            <div class="text-brand-dark font-bold text-lg">
                Build this workflow today in n8n.
            </div>
        </footer>

    </main>

    <script>
        // --- UTILITY FUNCTIONS ---

        /**
         * Splits a long string into an array of shorter strings based on a character limit.
         * Mandatory Requirement: Label Wrapping (16 chars).
         */
        function splitLabel(label, maxChars = 16) {
            if (label.length <= maxChars) return label;
            
            const words = label.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                if ((currentLine + ' ' + words[i]).length <= maxChars) {
                    currentLine += ' ' + words[i];
                } else {
                    lines.push(currentLine);
                    currentLine = words[i];
                }
            }
            lines.push(currentLine);
            return lines;
        }

        // Apply splitLabel to an array of labels
        function processLabels(labels) {
            return labels.map(label => splitLabel(label));
        }

        /**
         * Mandatory Requirement: Tooltip Configuration for Multiline Labels.
         */
        const commonChartOptions = {
            responsive: true,
            maintainAspectRatio: false, // Vital for Tailwind container control
            plugins: {
                legend: {
                    labels: {
                        font: { family: "'Segoe UI', 'Roboto', sans-serif" },
                        color: '#333'
                    }
                },
                tooltip: {
                    callbacks: {
                        title: function(tooltipItems) {
                            const item = tooltipItems[0];
                            let label = item.chart.data.labels[item.dataIndex];
                            if (Array.isArray(label)) {
                                return label.join(' ');
                            } else {
                                return label;
                            }
                        }
                    }
                }
            }
        };

        // --- CHART 1: RELIABILITY (Bar Chart) ---
        const ctxReliability = document.getElementById('reliabilityChart').getContext('2d');
        const rawReliabilityLabels = ['Basic HTTP Request', 'ScrapeNinja (Proxies + JS)'];
        
        new Chart(ctxReliability, {
            type: 'bar',
            data: {
                labels: processLabels(rawReliabilityLabels),
                datasets: [{
                    label: 'Success Rate on Complex Sites (%)',
                    data: [35, 98], // Hypothetical data illustrating the robustness point
                    backgroundColor: [
                        '#e2e8f0', // Gray for basic
                        '#FF6B6B'  // Brand Coral for ScrapeNinja
                    ],
                    borderColor: [
                        '#cbd5e1',
                        '#E05D5D'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                ...commonChartOptions,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });

        // --- CHART 2: TOKEN OPTIMIZATION (Donut Chart) ---
        const ctxToken = document.getElementById('tokenChart').getContext('2d');
        const rawTokenLabels = ['Useful Content (Text)', 'Junk (Scripts/Styles/SVG)'];

        new Chart(ctxToken, {
            type: 'doughnut',
            data: {
                labels: processLabels(rawTokenLabels),
                datasets: [{
                    label: 'HTML Composition',
                    data: [30, 70], // Illustrating that ~70% of raw HTML is often code noise
                    backgroundColor: [
                        '#4ECDC4', // Brand Teal (Good)
                        '#FFE66D'  // Brand Yellow (Junk/Filtered)
                    ],
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: {
                ...commonChartOptions,
                cutout: '60%'
            }
        });

        // --- CHART 3: TRANSFORMATION JOURNEY (Horizontal Bar) ---
        const ctxTrans = document.getElementById('transformationChart').getContext('2d');
        const rawTransLabels = ['Raw HTML Fetch', 'Cleaned HTML', 'Final JSON Output'];

        new Chart(ctxTrans, {
            type: 'bar', // Using horizontal bar by setting indexAxis
            data: {
                labels: processLabels(rawTransLabels),
                datasets: [{
                    label: 'Data Size (Approx. Characters)',
                    data: [150000, 45000, 500], // Logarithmic-ish scale visual
                    backgroundColor: [
                        '#1A535C', // Raw
                        '#4ECDC4', // Clean
                        '#FF6B6B'  // JSON
                    ],
                    borderRadius: 4
                }]
            },
            options: {
                ...commonChartOptions,
                indexAxis: 'y', // Makes it horizontal
                scales: {
                    x: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Character Count (Log Scale Visual)'
                        }
                    }
                }
            }
        });

    </script>
</body>
</html>
